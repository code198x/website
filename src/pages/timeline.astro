---
import { getEntry, getCollection } from 'astro:content';
import ArticleLayout from '../layouts/ArticleLayout.astro';
import Timeline from '../components/Timeline.astro';

const entry = await getEntry('timeline', 'index');
const { Content } = await entry.render();
const { title, description } = entry.data;

// Get all platform entries and extract the necessary data
const platforms = await getCollection('platforms');
const platformData = platforms.map(platform => ({
    title: platform.data.title,
    year: platform.data.year,
    endYear: platform.data.endYear,
    type: platform.data.type,
    manufacturer: platform.data.manufacturer,
    description: platform.data.description,
    slug: platform.slug
}));

// Add a legend for the platform types
const types = [...new Set(platformData.map(p => p.type))];
---
<ArticleLayout title={title} description={description}>
    <Content />
    
    <div class="legend">
        {types.map(type => (
            <div class="legend-item">
                <span 
                    class="legend-color" 
                    style={`background-color: ${
                        type === "Home Computer" || type === "Home/Personal Computer" ? "#2563eb" :
                        type === "Game Console" || type === "Video Game Console" ? "#dc2626" :
                        type === "Handheld Game Console" ? "#16a34a" :
                        type === "Computer Standard" ? "#7c3aed" : "#6b7280"
                    }`}
                ></span>
                <span class="legend-label">{type}</span>
            </div>
        ))}
    </div>

    <Timeline platforms={platformData} />
</ArticleLayout>

<style>
    .legend {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 2rem;
        padding: 1rem;
        background: #f8fafc;
        border-radius: 0.5rem;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .legend-color {
        width: 1rem;
        height: 1rem;
        border-radius: 0.25rem;
    }

    .legend-label {
        font-size: 0.875rem;
        color: #4b5563;
    }
</style> 