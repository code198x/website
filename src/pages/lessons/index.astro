---
import Layout from "../../layouts/BaseLayout.astro";
import fs from "node:fs";
import path from "node:path";
import { getCollection } from "astro:content";

const allSystems = await getCollection("systems");

// Path to the lessons content folder
const lessonsPath = path.resolve("./src/content/lessons");

// Read directories that exist under lessonsPath
const systemsWithLessons = fs
  .readdirSync(lessonsPath, { withFileTypes: true })
  .filter((entry) => entry.isDirectory())
  .map((entry) => entry.name);

// Filter systems that have corresponding lesson content
const systems = allSystems.filter((system) =>
  systemsWithLessons.includes(system.slug)
);
---

<Layout title="Lessons">
  <ul>
    {systems.map((system) => (
      <li><a href={`/lessons/${system.slug}`}>{system.data.name}</a></li>
    ))}
  </ul>
</Layout>