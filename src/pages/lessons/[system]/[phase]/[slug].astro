---
import { getCollection } from 'astro:content';
import Layout from '../../../../layouts/Layout.astro';
const { system, phase, slug } = Astro.params;
const lessons = await getCollection('lessons') as any[];
const lesson = lessons.find(
  l =>
    l.slug === [system, phase, slug].join('/') ||
    l.slug === `${system}/${phase}/${slug}`
);
if (!lesson) throw new Error('Lesson not found');

export async function getStaticPaths() {
  const lessons = await getCollection('lessons') as any[];
  return lessons.map(lesson => {
    const [system, phase, ...slugParts] = lesson.slug.split('/');
    return {
      params: {
        system,
        phase,
        slug: slugParts.join('/'),
      },
    };
  });
}
---

<Layout>
  <h1>{lesson.data.title}</h1>
  {lesson.data.summary && <p>{lesson.data.summary}</p>}
  <article set:html={lesson.body} />
</Layout> 