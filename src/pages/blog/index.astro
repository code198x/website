---
// import Layout from '../../layouts/Layout.astro'; // No longer needed directly
import ListPageLayout from '../../layouts/ListPageLayout.astro'; // Use the new layout
import Pagination from '../../components/Pagination.astro'; // Import the pagination component
import { getCollection } from 'astro:content';

// Astro expects a `getStaticPaths` function for paginated routes
export async function getStaticPaths({ paginate }) {
  const posts = await getCollection('posts');
  // Sort posts by publish date descending
  posts.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());

  return paginate(posts, { pageSize: 10 });
}

// The page prop comes from getStaticPaths
const { page } = Astro.props;

const pageTitle = "Blog - Code 198x";
const pageDescription = "News, updates, and other articles.";
---
<ListPageLayout 
  title={pageTitle}
  description={pageDescription}
  items={page.data} // Pass the paginated data to the layout
>
  {/* Define the content for each list item using the named slot */}
  <Fragment slot="list-item" let:item={post}>
    <a href={`/blog/${post.slug}`} class="item-title">{post.data.title}</a>
    {post.data.description && <p class="item-description">{post.data.description}</p>}
    <time datetime={post.data.publishDate.toISOString()} class="item-date">
      {post.data.publishDate.toLocaleDateString('en-us', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
      })}
    </time>
    {/* Add tags if desired */}
    {post.data.tags && post.data.tags.length > 0 && 
      <p class="item-tags">Tags: {post.data.tags.join(', ')}</p>
    }
  </Fragment>

  {/* Add Pagination component below the list */}
  <Pagination page={page} />
</ListPageLayout>

<style>
  /* Add specific styles for the blog list items */
  .item-title {
    font-size: 1.2em;
    font-weight: bold;
    text-decoration: none;
    display: block;
    margin-bottom: 0.25em;
  }
  .item-title:hover {
    text-decoration: underline;
  }
  .item-description {
    margin-bottom: 0.5em;
    color: var(--color-text-muted);
  }
  .item-date,
  .item-tags {
    font-size: 0.85em;
    color: var(--color-text-muted);
    display: block; /* Ensure they appear on new lines */
  }
  .item-tags {
      margin-top: 0.25em;
  }
</style> 